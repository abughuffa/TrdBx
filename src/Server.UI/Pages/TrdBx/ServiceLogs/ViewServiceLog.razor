@page "/pages/TrdBx/ServiceLogs/{id:int}/view"

@using CleanArchitecture.Blazor.Server.UI.Pages.TrdBx.ServiceLogs
@using CleanArchitecture.Blazor.Application.Features.ServiceLogs.DTOs
@using CleanArchitecture.Blazor.Application.Features.ServiceLogs.Queries.GetById

@inherits MudComponentBase
@inject IStringLocalizer<ServiceLogs> L
@inject NavigationManager Navigation
@attribute [Authorize(Policy = Infrastructure.PermissionSet.Permissions.ServiceLogs.View)]

<PageTitle>@Title</PageTitle>

<MudContainer Class="mt-3" MaxWidth="MaxWidth.Large">
    @if (model != null)
    {
        <MudCard Class="pa-2">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">@Title</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudGrid Spacing="3" Class="readonly-grid">
                    <MudItem md="4">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x=>x.ServiceNo)]" Value="model.ServiceNo"></ReadOnlyFieldX6>
                    </MudItem>
                    <MudItem md="6">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x=>x.SerDate)]" Value="model.SerDate"></ReadOnlyFieldX6>
                    </MudItem>
                    <MudItem md="12">
                        <ReadOnlyFieldX12 Label="@L[model.GetMemberDescription(x=>x.Desc)]" Value="model.Desc"></ReadOnlyFieldX12>
                    </MudItem>
                     <MudItem md="4">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x=>x.IsDeserved)]" Value="model.IsDeserved"></ReadOnlyFieldX6>
                    </MudItem>
                     <MudItem md="4">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x=>x.IsBilled)]" Value="model.IsBilled"></ReadOnlyFieldX6>
                    </MudItem>
                    <MudItem md="4">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x=>x.Amount)]" Value="model.Amount"></ReadOnlyFieldX6>
                    </MudItem>

                </MudGrid>
            </MudCardContent>
            <MudCardActions>
                <MudButton Color="Color.Primary" DropShadow="false" OnClick="OnGoBack">@ConstantString.GoBack</MudButton>
            </MudCardActions>
        </MudCard>
    }
</MudContainer>


@code {
    public string? Title { get; private set; }
    [Parameter]
    public int Id { get; set; }

    private ServiceLogDto? model;


    [Parameter]
    [SupplyParameterFromQuery]
    public string? ReturnUrl { get; set; }


    protected override async Task OnInitializedAsync()
    {
        Title = L["ServiceLogs"];


        var result = await Mediator.Send(new GetServiceLogByIdQuery() { Id = Id });

        result.Map(data =>
      {
          model = data;
          return data;
      }).Match(data =>
      {
          return data;

      }, errors =>
      {
          Snackbar.Add(errors, MudBlazor.Severity.Error);
          return null!;
      });
    }


    void OnGoBack()
    {
        ReturnBack();
    }

    void ReturnBack()
    {
        var target = !string.IsNullOrWhiteSpace(ReturnUrl)
            ? ReturnUrl
            : Navigation.ToBaseRelativePath(Navigation.Uri);
        Navigation.NavigateTo(target);
    }


}
