@page "/pages/TrdBx/Invoices/{id:int}/view"


@using CleanArchitecture.Blazor.Application.Features.Invoices.DTOs
@using CleanArchitecture.Blazor.Application.Features.Invoices.Queries.GetById

@inherits MudComponentBase
@inject IStringLocalizer<Invoices> L
@attribute [Authorize(Policy = Infrastructure.PermissionSet.Permissions.Invoices.View)]

<PageTitle>@Title</PageTitle>

<MudContainer Class="mt-3" MaxWidth="MaxWidth.Small">
    @if (model != null)
    {
        <MudCard Class="pa-2">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">@Title</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudGrid Spacing="3" Class="readonly-grid">



                    <MudItem md="4">
                        <ReadOnlyField Label="@L[model.GetMemberDescription(x=>x.InvNo)]" Value="model.InvNo"></ReadOnlyField>
                    </MudItem>
                    <MudItem md="4">
                        <ReadOnlyField Label="@L[model.GetMemberDescription(x=>x.InvDate)]" Value="model.InvDate"></ReadOnlyField>
                    </MudItem> 
                    <MudItem md="4">
                        <ReadOnlyField Label="@L[model.GetMemberDescription(x=>x.DueDate)]" Value="model.DueDate"></ReadOnlyField>
                    </MudItem>

                    <MudItem md="12">
                        <ReadOnlyField Label="@L[model.GetMemberDescription(x=>x.InvDesc)]" Value="model.InvDesc"></ReadOnlyField>
                    </MudItem>
@*                     <MudItem md="12">
                        <ReadOnlyField Label="@L[model.GetMemberDescription(x=>x.CustomerId)]" Value="model.CustomerId"></ReadOnlyField>
                    </MudItem> *@
                    <MudItem md="12">
                        <ReadOnlyField Label="@L[model.GetMemberDescription(x => x.Customer)]" Value="model.Customer"></ReadOnlyField>
                    </MudItem>
                </MudGrid>
            </MudCardContent>
            <MudCardActions>
                <MudButton Color="Color.Primary" DropShadow="false" OnClick="OnGoBack">@ConstantString.GoBack</MudButton>
            </MudCardActions>
        </MudCard>
    }
</MudContainer>


@code {
    [Parameter] public int Id { get; set; }

    public string? Title { get; private set; }
    private InvoiceDto? model;

    protected override async Task OnInitializedAsync()
    {
        Title = L["Invoice"];
        var result = await Mediator.Send(new GetInvoiceByIdQuery() { Id = Id });

        result.Map(data =>
{
    model = data;
    return data;
}).Match(data =>
{
    return data;

}, errors =>
{
    Snackbar.Add(errors, MudBlazor.Severity.Error);
    return null!;
});



    }

    void OnGoBack()
    {
        Navigation.NavigateTo($"/pages/TrdBx/Invoices");
    }
}
