@page "/pages/TrdBx/TrackedAssets/{id:int}/view"

@using CleanArchitecture.Blazor.Application.Features.TrackedAssets.DTOs
@using CleanArchitecture.Blazor.Application.Features.TrackedAssets.Queries.GetById


@inherits MudComponentBase
@inject IStringLocalizer<TrackedAssets> L
@inject NavigationManager Navigation
@attribute [Authorize(Policy = Infrastructure.PermissionSet.Permissions.TrackedAssets.View)]

<PageTitle>@Title</PageTitle>

<MudContainer Class="mt-3" MaxWidth="MaxWidth.Medium">
    @if (model != null)
    {
        <MudCard Class="pa-2">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">@Title</MudText>
                </CardHeaderContent>
            </MudCardHeader>
            <MudCardContent>
                <MudGrid Spacing="3" Class="readonly-grid">
                    <MudItem md="12">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x => x.TrackedAssetNo)]" Value="model.TrackedAssetNo"></ReadOnlyFieldX6>
                    </MudItem>
                    <MudItem md="12">
                        <ReadOnlyFieldX12 Label="@L[model.GetMemberDescription(x => x.TrackedAssetDesc)]" Value="model.TrackedAssetDesc"></ReadOnlyFieldX12>
                    </MudItem>
                    <MudItem md="4">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x => x.TrackedAssetCode)]" Value="model.TrackedAssetCode"></ReadOnlyFieldX6>
                    </MudItem>
                    <MudItem md="4">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x => x.PlateNo)]" Value="model.PlateNo"></ReadOnlyFieldX6>
                    </MudItem>
                    <MudItem md="6">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x => x.VinSerNo)]" Value="model.VinSerNo"></ReadOnlyFieldX6>
                    </MudItem>
                    <MudItem md="6">
                        <ReadOnlyFieldX6 Label="@L[model.GetMemberDescription(x => x.IsAvaliable)]" Value="model.IsAvaliable" CheckBox="true"></ReadOnlyFieldX6>
                    </MudItem>
                </MudGrid>
            </MudCardContent>
            <MudCardActions>
                <MudButton Color="Color.Primary" DropShadow="false" OnClick="OnGoBack">@ConstantString.GoBack</MudButton>
            </MudCardActions>
        </MudCard>
    }
</MudContainer>


@code {
    public string? Title { get; private set; }
    [Parameter]
    public int Id { get; set; }
    private TrackedAssetDto? model;


    [Parameter]
    [SupplyParameterFromQuery]
    public string? ReturnUrl { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Title = L["TrackedAsset"];

        var result = await Mediator.Send(new GetTrackedAssetByIdQuery() { Id = Id });


        result.Map(data =>
{
    model = data;
    return data;
}).Match(data =>
{
    return data;

}, errors =>
{
    Snackbar.Add(errors, MudBlazor.Severity.Error);
    return null!;
});



    }


    void OnGoBack()
    {
        ReturnBack();
    }

    void ReturnBack()
    {
        var target = !string.IsNullOrWhiteSpace(ReturnUrl)
            ? ReturnUrl
            : Navigation.ToBaseRelativePath(Navigation.Uri);
        Navigation.NavigateTo(target);
    }
}
